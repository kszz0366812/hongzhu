# 终端商户导入功能说明

## 功能概述
终端商户管理模块已支持Excel批量导入功能，可以快速导入大量终端商户数据。

## 功能特点

### 1. 支持的Excel格式
- 文件格式：`.xlsx`、`.xls`
- 文件大小：最大100MB（支持百万级数据）
- 编码格式：UTF-8

### 2. 导入字段说明
| 字段名 | 必填 | 说明 | 示例 |
|--------|------|------|------|
| 终端名称 | 是 | 终端商户名称 | 北京朝阳终端 |
| 终端编码 | 是 | 终端唯一标识码 | T001 |
| 客户经理 | 否 | 负责的客户经理姓名 | 张经理 |
| 标签 | 否 | 终端标签信息 | 重点客户,高价值 |
| 终端类型 | 否 | 终端类型分类 | 零售终端 |
| 是否排线 | 否 | 是否排线拜访(0:否,1:是) | 1 |

### 3. 数据验证规则
- **终端编码**：必填，不能为空
- **终端名称**：必填，不能为空
- **是否排线**：可选，默认为0（否），有效值为0或1

## 使用方法

### 1. 前端操作步骤
1. 进入终端管理页面
2. 点击"导入"按钮
3. 在导入对话框中点击"下载模板"
4. 下载Excel模板文件
5. 按照模板格式填写数据
6. 点击"开始导入"上传文件
7. 等待导入完成

### 2. 导入流程
1. **文件验证**：检查文件格式和大小
2. **数据读取**：使用EasyExcel读取Excel数据
3. **数据验证**：验证必填字段和格式
4. **数据转换**：将Excel数据转换为实体对象
5. **数据库插入**：批量插入到数据库
6. **结果反馈**：返回导入结果统计

## 技术实现

### 1. 后端架构
```
ExcelController (统一入口)
    ↓
ExcelService (服务接口)
    ↓
ExcelServiceImpl (服务实现)
    ↓
TerminalExcelDTO (数据转换)
    ↓
TerminalInfoService (业务服务)
    ↓
TerminalInfoMapper (数据访问)
```

### 2. 关键组件

#### ExcelController
- 提供统一的Excel导入接口：`/excel/import`
- 支持多种导入类型：员工、产品、终端商户等
- 文件大小限制：100MB

#### TerminalExcelDTO
- 定义Excel字段映射关系
- 提供数据验证逻辑
- 实现数据转换方法

#### ExcelServiceImpl
- 使用EasyExcel进行文件解析
- 支持百万级数据导入
- 提供进度反馈和错误处理

### 3. 数据流程
```
Excel文件 → EasyExcel解析 → TerminalExcelDTO → 数据验证 → TerminalInfo实体 → 数据库插入
```

## 错误处理

### 1. 常见错误类型
- **文件格式错误**：非Excel文件
- **文件过大**：超过100MB限制
- **数据格式错误**：必填字段为空
- **数据库错误**：插入失败

### 2. 错误反馈
- 导入结果会显示成功和失败的记录数
- 失败的记录会记录具体错误原因
- 支持部分成功的情况（部分数据导入成功）

## 性能优化

### 1. 大数据量处理
- 使用EasyExcel的流式读取
- 分批处理数据，避免内存溢出
- 支持百万级数据导入

### 2. 数据库优化
- 批量插入减少数据库交互
- 事务管理确保数据一致性
- 索引优化提升插入性能

## 安全考虑

### 1. 文件安全
- 文件类型验证
- 文件大小限制
- 文件名安全检查

### 2. 数据安全
- 数据格式验证
- SQL注入防护
- 事务回滚机制

## 测试建议

### 1. 功能测试
- 测试正常数据导入
- 测试异常数据处理
- 测试大文件导入

### 2. 性能测试
- 测试大数据量导入
- 测试并发导入
- 测试内存使用情况

### 3. 兼容性测试
- 测试不同Excel版本
- 测试不同操作系统
- 测试不同浏览器

## 扩展功能

### 1. 可能的扩展
- 支持更多文件格式（CSV等）
- 添加数据预览功能
- 支持增量导入
- 添加导入历史记录

### 2. 配置化支持
- 字段映射配置
- 验证规则配置
- 导入模板配置

## 注意事项

1. **数据备份**：导入前建议备份数据库
2. **数据验证**：导入后检查数据完整性
3. **权限控制**：确保只有授权用户可以导入
4. **日志记录**：保留导入操作日志
5. **错误处理**：妥善处理导入失败的情况

## 联系支持

如遇到导入问题，请联系技术支持团队。 
 