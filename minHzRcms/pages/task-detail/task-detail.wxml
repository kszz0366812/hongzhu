<!-- pages/task-detail/task-detail.wxml -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- ä»»åŠ¡è¯¦æƒ…å†…å®¹ -->
  <view class="task-detail" wx:else>
    <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
    <view class="task-header">
      <view class="task-title">{{task.title}}</view>
      <view class="task-meta">
        <view class="task-status status-{{task.status === 'è¿›è¡Œä¸­' ? 'running' : task.status === 'å·²å®Œæˆ' ? 'completed' : 'pending'}}">
          {{task.status}}
        </view>
        <view class="task-priority priority-{{task.priority}}">
          {{task.priorityText}}
        </view>
      </view>
    </view>

    <!-- ä»»åŠ¡è¯¦ç»†ä¿¡æ¯ -->
    <view class="task-info">
      <view class="info-item">
        <text class="label">æ‰€å±é¡¹ç›®</text>
        <text class="value">{{task.project}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">è´Ÿè´£äºº</text>
        <text class="value">{{task.assignee}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">æŒ‡æ´¾è€…</text>
        <text class="value">{{task.assigner}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">æˆªæ­¢æ—¶é—´</text>
        <text class="value {{task.isOverdue ? 'overdue' : ''}}">{{task.deadline}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">åˆ›å»ºæ—¶é—´</text>
        <text class="value">{{task.createTime}}</text>
      </view>
      
      <view class="info-item" wx:if="{{task.updateTime}}">
        <text class="label">æ›´æ–°æ—¶é—´</text>
        <text class="value">{{task.updateTime}}</text>
      </view>
    </view>

    <!-- ä»»åŠ¡æè¿° -->
    <view class="task-description" wx:if="{{task.description}}">
      <view class="description-title">ä»»åŠ¡æè¿°</view>
      <view class="description-content">{{task.description}}</view>
    </view>

    <!-- é™„ä»¶åˆ—è¡¨ -->
    <view class="attachments-section">
      <view class="section-title">é™„ä»¶</view>
      <view wx:if="{{task.attachments && task.attachments.length > 0}}" class="attachment-list">
        <view class="attachment-item" wx:for="{{task.attachments}}" wx:key="index">
          <view class="attachment-icon">ğŸ“</view>
          <view class="attachment-info">
            <view class="attachment-name">{{item.name}}</view>
            <view class="attachment-size">{{item.size}}</view>
          </view>
        </view>
      </view>
      <view wx:else class="no-attachments">
        <view class="no-attachments-icon">ğŸ“„</view>
        <view class="no-attachments-text">æš‚æ— é™„ä»¶</view>
      </view>
    </view>


  </view>

  <!-- çŠ¶æ€æ›´æ–°å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showStatusModal}}" bindtap="closeStatusModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ›´æ–°ä»»åŠ¡çŠ¶æ€</text>
        <text class="modal-close" bindtap="closeStatusModal">Ã—</text>
      </view>
      <view class="modal-body">
        <view class="status-options">
          <view class="status-option {{selectedStatus === status ? 'selected' : ''}}" 
                wx:for="{{availableStatuses}}" 
                wx:key="index" 
                wx:for-item="status"
                data-status="{{status}}"
                bindtap="selectStatus">
            {{status}}
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn btn-outline" bindtap="closeStatusModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="confirmStatusUpdate">ç¡®è®¤</button>
      </view>
    </view>
  </view>

  <!-- æŒ‡æ´¾å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showAssignModal}}" bindtap="closeAssignModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">é‡æ–°æŒ‡æ´¾ä»»åŠ¡</text>
        <text class="modal-close" bindtap="closeAssignModal">Ã—</text>
      </view>
      <view class="modal-body">
        <member-selector 
          members="{{assignMembers}}"
          bind:memberSelect="onAssignMemberSelect"
          bind:close="closeAssignModal">
        </member-selector>
      </view>
    </view>
  </view>
</view>