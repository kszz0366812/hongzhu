<!-- pages/task-form/task-form.wxml -->
<view class="container">
  <!-- 表单区域 -->
  <view class="form-section">
    <view class="form-item">
      <text class="label">任务标题 <text class="required">*</text></text>
      <input class="input" placeholder="请输入任务标题" value="{{taskForm.title}}" bindinput="updateForm" data-field="title" />
    </view>
    
    <view class="form-item">
      <text class="label">所属项目 <text class="required">*</text></text>
      <picker class="picker" range="{{projects}}" range-key="name" value="{{taskForm.projectIndex}}" bindchange="updateForm" data-field="projectIndex">
        <view class="picker-text {{taskForm.projectIndex !== undefined ? '' : 'placeholder'}}">
          {{projects[taskForm.projectIndex].name || '请选择项目'}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">负责人 <text class="required">*</text></text>
      <picker class="picker" range="{{teamMembers}}" range-key="name" value="{{taskForm.assigneeIndex}}" bindchange="updateForm" data-field="assigneeIndex">
        <view class="picker-text {{taskForm.assigneeIndex !== undefined ? '' : 'placeholder'}}">
          {{teamMembers[taskForm.assigneeIndex].name || '请选择负责人'}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">优先级 <text class="required">*</text></text>
      <picker class="picker" range="{{priorities}}" value="{{taskForm.priorityIndex}}" bindchange="updateForm" data-field="priorityIndex">
        <view class="picker-text">
          {{priorities[taskForm.priorityIndex]}}
        </view>
      </picker>
    </view>
    
    <!-- 编辑模式下显示状态选择 -->
    <view class="form-item" wx:if="{{operationMode === 'edit'}}">
      <text class="label">任务状态 <text class="required">*</text></text>
      <picker class="picker" range="{{taskStatuses}}" value="{{taskForm.statusIndex}}" bindchange="updateForm" data-field="statusIndex">
        <view class="picker-text">
          {{taskStatuses[taskForm.statusIndex]}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">截止时间 <text class="required">*</text></text>
      <picker class="picker" mode="date" value="{{taskForm.deadline}}" bindchange="updateForm" data-field="deadline">
        <view class="picker-text {{taskForm.deadline ? '' : 'placeholder'}}">
          {{taskForm.deadline || '请选择截止时间'}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">任务描述</text>
      <textarea class="textarea" placeholder="请输入任务描述" value="{{taskForm.description}}" bindinput="updateForm" data-field="description"></textarea>
    </view>

    <view class="form-item">
      <text class="label">附件</text>
      <attachment-uploader 
        attachments="{{taskForm.attachments}}"
        maxCount="{{5}}"
        bind:change="onAttachmentChange"
      />
    </view>
  </view>
  
  <view class="button-section">
    <button class="submit-btn" bindtap="submitTask">{{operationMode === 'edit' ? '更新任务' : '创建任务'}}</button>
  </view>
</view> 