<!-- pages/create-project/create-project.wxml -->
<view class="container">
  <!-- è¡¨å•åŒºåŸŸ -->
  <view class="form-section">
    <view class="form-item">
      <text class="label">é¡¹ç›®åç§° <text class="required">*</text></text>
      <input class="input" 
             placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°" 
             value="{{projectForm.name}}"
             data-field="name"
             bindinput="updateForm" />
    </view>
    
    <view class="form-item">
      <text class="label">é¡¹ç›®æè¿°</text>
      <textarea class="textarea" 
                placeholder="è¯·è¾“å…¥é¡¹ç›®æè¿°" 
                value="{{projectForm.description}}"
                data-field="description"
                bindinput="updateForm" />
    </view>
    
    <view class="form-item">
      <text class="label">å¼€å§‹æ—¥æœŸ <text class="required">*</text></text>
      <picker class="picker" mode="date" 
              value="{{projectForm.startDate}}"
              data-field="startDate"
              bindchange="updatePicker">
        <view class="picker-text {{projectForm.startDate ? '' : 'placeholder'}}">
          {{projectForm.startDate || 'è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ'}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">ç»“æŸæ—¥æœŸ <text class="required">*</text></text>
      <picker class="picker" mode="date" 
              value="{{projectForm.endDate}}"
              data-field="endDate"
              bindchange="updatePicker">
        <view class="picker-text {{projectForm.endDate ? '' : 'placeholder'}}">
          {{projectForm.endDate || 'è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ'}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">é¡¹ç›®è´Ÿè´£äºº</text>
      <selector-field 
        placeholder="è¯·é€‰æ‹©é¡¹ç›®è´Ÿè´£äºº"
        selectedText="{{projectForm.selectedManager ? projectForm.selectedManager.name : ''}}"
        bind:tap="selectManager"
      />
    </view>
    
    <view class="form-item">
      <text class="label">é¡¹ç›®ç­‰çº§</text>
      <picker class="picker" range="{{levels}}" 
              value="{{projectForm.levelIndex}}"
              data-field="levelIndex"
              bindchange="updatePicker">
        <view class="picker-text">
          {{levels[projectForm.levelIndex]}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">ä¼˜å…ˆçº§</text>
      <picker class="picker" range="{{priorities}}" 
              value="{{projectForm.priorityIndex}}"
              data-field="priorityIndex"
              bindchange="updatePicker">
        <view class="picker-text">
          {{priorities[projectForm.priorityIndex]}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">é¡¹ç›®æˆå‘˜</text>
      <view class="members-section">
        <!-- å·²é‚€è¯·çš„æˆå‘˜åˆ—è¡¨ -->
        <view class="invited-members" wx:if="{{projectForm.invitedMembers.length > 0}}">
          <view class="member-item" wx:for="{{projectForm.invitedMembers}}" wx:key="id">
            <view class="member-avatar">
              <image wx:if="{{item.avatar}}" src="{{item.avatar}}" class="avatar-img" mode="aspectFill" />
              <image wx:else src="/utils/images/default-avatar.png" class="avatar-img" mode="aspectFill" />
            </view>
            <view class="member-info">
              <text class="member-name">{{item.name}}</text>
              <text class="member-role">{{item.role}}</text>
            </view>
            <view class="remove-member" bindtap="removeMember" data-id="{{item.id}}"></view>
          </view>
        </view>
        
        <!-- é‚€è¯·æˆå‘˜æŒ‰é’® -->
        <view class="invite-section">
          <button class="invite-btn" bindtap="inviteMembers">
            <text class="invite-icon">ğŸ‘¥</text>
            <text class="invite-text">é‚€è¯·æˆå‘˜</text>
          </button>
        </view>
      </view>
    </view>
    
    <view class="form-item">
      <text class="label">é¡¹ç›®çŠ¶æ€</text>
      <picker class="picker" range="{{statuses}}" 
              value="{{projectForm.statusIndex}}"
              data-field="statusIndex"
              bindchange="updatePicker">
        <view class="picker-text">
          {{statuses[projectForm.statusIndex]}}
        </view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">é™„ä»¶</text>
      <attachment-uploader 
        attachments="{{projectForm.attachments}}"
        maxCount="{{10}}"
        bind:change="onAttachmentChange"
      />
    </view>
  </view>
  
  <view class="button-section">
    <button class="submit-btn" bindtap="submitProject">{{isEditMode ? 'ä¿å­˜ä¿®æ”¹' : 'åˆ›å»ºé¡¹ç›®'}}</button>
  </view>
</view>

<!-- äººå‘˜é€‰æ‹©ç»„ä»¶ -->
<member-selector 
  show="{{showInviteModal}}"
  title="é‚€è¯·æˆå‘˜"
  placeholder="æœç´¢æˆå‘˜..."
  members="{{availableMembers}}"
  multiple="{{true}}"
  selectedIds="{{invitedMemberIds}}"
  confirmText="é‚€è¯·"
  bind:close="onInviteModalClose"
  bind:select="onInviteMemberSelect"
/>

<!-- è´Ÿè´£äººé€‰æ‹©ç»„ä»¶ -->
<member-selector 
  show="{{showManagerModal}}"
  title="é€‰æ‹©é¡¹ç›®è´Ÿè´£äºº"
  placeholder="æœç´¢è´Ÿè´£äºº..."
  members="{{teamMembers}}"
  multiple="{{false}}"
  bind:close="onManagerModalClose"
  bind:select="onManagerSelect"
/>
 